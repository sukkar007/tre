#!/bin/bash

# ๐ ุณูุฑูุจุช ุจูุงุก ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ - HUS App Demo
# ูููู ุจุจูุงุก APK ุชุฌุฑูุจู ุจุฏูู ุงูุญุงุฌุฉ ูุฅุนุฏุงุฏุงุช Firebase ุฃู ZegoCloud

echo "๐ฏ ุจุฏุก ุจูุงุก ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ ูุชุทุจูู HUS..."
echo "=================================================="

# ุงูุชุญูู ูู ูุฌูุฏ Flutter
if ! command -v flutter &> /dev/null; then
    echo "โ ุฎุทุฃ: Flutter ุบูุฑ ูุซุจุช ุฃู ุบูุฑ ููุฌูุฏ ูู PATH"
    echo "ูุฑุฌู ุชุซุจูุช Flutter ุฃููุงู ูู: https://flutter.dev/docs/get-started/install"
    exit 1
fi

# ุงูุชุญูู ูู ุฅุตุฏุงุฑ Flutter
echo "๐ ูุญุต ุฅุตุฏุงุฑ Flutter..."
flutter --version

# ุงูุงูุชูุงู ููุฌูุฏ ุงููุดุฑูุน
cd frontend || {
    echo "โ ุฎุทุฃ: ูุง ูููู ุงูุนุซูุฑ ุนูู ูุฌูุฏ frontend"
    exit 1
}

echo ""
echo "๐ง ุชุญุถูุฑ ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ..."

# ูุณุฎ ุฅุนุฏุงุฏุงุช ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ
if [ -f "pubspec_demo.yaml" ]; then
    cp pubspec_demo.yaml pubspec.yaml
    echo "โ ุชู ุชุญุฏูุซ pubspec.yaml ูููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ"
else
    echo "โ๏ธ  ุชุญุฐูุฑ: ููู pubspec_demo.yaml ุบูุฑ ููุฌูุฏุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ"
fi

echo ""
echo "๐ฆ ุชุซุจูุช ุงูุชุจุนูุงุช..."

# ุชูุธูู ุงููุดุฑูุน
flutter clean

# ุชุซุจูุช ุงูุชุจุนูุงุช
flutter pub get

if [ $? -ne 0 ]; then
    echo "โ ุฎุทุฃ ูู ุชุซุจูุช ุงูุชุจุนูุงุช"
    echo "ูุฑุฌู ุงูุชุญูู ูู ููู pubspec.yaml ูุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช"
    exit 1
fi

echo ""
echo "๐ ูุญุต ุงููุดุฑูุน..."

# ูุญุต ุงููุดุฑูุน ููุฃุฎุทุงุก
flutter analyze --no-fatal-infos

echo ""
echo "๐๏ธ  ุจูุงุก APK ุงูุชุฌุฑูุจู..."

# ุจูุงุก APK ูููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ
flutter build apk --debug --target=lib/main.dart

if [ $? -eq 0 ]; then
    echo ""
    echo "๐ ุชู ุจูุงุก APK ุงูุชุฌุฑูุจู ุจูุฌุงุญ!"
    echo "=================================================="
    echo "๐ฑ ูุณุงุฑ ุงูููู:"
    echo "   build/app/outputs/flutter-apk/app-debug.apk"
    echo ""
    echo "๐ ูุนูููุงุช ุงูููู:"
    if [ -f "build/app/outputs/flutter-apk/app-debug.apk" ]; then
        ls -lh build/app/outputs/flutter-apk/app-debug.apk
        echo ""
        echo "๐ง ูุชุซุจูุช APK ุนูู ุงูุฌูุงุฒ:"
        echo "   adb install build/app/outputs/flutter-apk/app-debug.apk"
        echo ""
        echo "๐ฑ ุฃู ุงุณุชุฎุฏู:"
        echo "   flutter install"
        echo ""
        echo "๐ฏ ููุฒุงุช ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ:"
        echo "   โ ุชุณุฌูู ุฏุฎูู ููุฑู"
        echo "   โ 4 ุบุฑู ุตูุชูุฉ ููููุฉ"
        echo "   โ 5 ูุณุชุฎุฏููู ุชุฌุฑูุจููู"
        echo "   โ ุฏุฑุฏุดุฉ ููุณุงุฆุท ููููุฉ"
        echo "   โ ุฌููุน ุงููุงุฌูุงุช ุชุนูู"
        echo ""
        echo "โ๏ธ  ููุงุญุธุฉ: ุงูุจูุงูุงุช ููููุฉ ููุง ุชุญุชุงุฌ ุงุชุตุงู ุฅูุชุฑูุช"
    fi
else
    echo ""
    echo "โ ูุดู ูู ุจูุงุก APK"
    echo "ูุฑุฌู ุงูุชุญูู ูู ุงูุฃุฎุทุงุก ุฃุนูุงู ูุฅุนุงุฏุฉ ุงููุญุงููุฉ"
    exit 1
fi

echo ""
echo "๐ ุงูุชูู ุจูุงุก ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ!"

