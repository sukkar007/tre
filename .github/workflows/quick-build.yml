name: ⚡ Quick Build APK

on:
  workflow_dispatch:
    inputs:
      message:
        description: 'Build Message'
        required: false
        default: 'Quick build requested'

jobs:
  quick-build:
    name: ⚡ Quick APK Build
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v4
      
    - name: ☕ Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        
    - name: 🐦 Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.32.8'
        channel: 'stable'
        cache: true
        
    - name: 🔧 Prepare Build
      working-directory: frontend
      run: |
        flutter clean
        flutter pub get
        
        # Create minimal Firebase config
        mkdir -p android/app
        cat > android/app/google-services.json << 'EOF'
        {
          "project_info": {
            "project_number": "123456789",
            "project_id": "hus-demo"
          },
          "client": [{
            "client_info": {
              "mobilesdk_app_id": "1:123456789:android:demo",
              "android_client_info": {
                "package_name": "com.flamingolive.hus"
              }
            },
            "api_key": [{"current_key": "demo_key"}],
            "services": {"appinvite_service": {}}
          }]
        }
        EOF
        
    - name: 🔨 Build APK
      working-directory: frontend
      run: flutter build apk --debug --verbose
      
    - name: 📤 Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: hus-quick-build-${{ github.run_number }}
        path: frontend/build/app/outputs/flutter-apk/app-debug.apk
        retention-days: 7

